<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" href="styles.css">
	<title>jQuiz</title>
	<style>


	</style>
</head>

<body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
	<script type="text/javascript"  src='http://cdn.renderedfont.com/js/renderedfont-0.8.min.js#free'></script>

	<center>
		<h1 id="question" text-align: center;>What do you like to do on the weekends? <br> (click the picture)</h1>


		<div id="firstRow" class="row">
			<div class="column">
				<figure>
					<img id="l1" src="./img/q1Social.jpg" style="width:100%" onclick="nextQuestion('l1')">
					<figcaption id="l1caption"> Interacting with friends </figcaption>
				</figure>
			</div>
			<div class="column">
				<figure>
					<img id="l2" src="./img/q1Tech.jpg" style="width:100%" onclick="nextQuestion('l2')">
					<figcaption id="l2caption"> Entertaining with technology </figcaption>
				</figure>
			</div>
		</div>
		<div id="secondRow" class="row">
			<div class="column">
				<figure>
					<img id="l3" src="./img/q1Lifestyle.jpg" style="width:100%" onclick="nextQuestion('l3')">
					<figcaption id="l3caption"> Working out in a gym </figcaption>
				</figure>
			</div>
			<div class="column">
				<figure>
					<img id="l4" src="./img/q1Luxury.jpg" style="width:100%" onclick="nextQuestion('l4')">
					<figcaption id="l4caption"> Shopping for luxury items </figcaption>
				</figure>
			</div>
		</div>

	</center>


	<script>

	var tech = 0;
	var social = 0;
	var lifestyle = 0;
	var qn = 0;


	var allQ = ["How did you learn about IQOS?",
	"People would describe me as:",
	"What is your ideal date night?",
	"What are you most likely to splurge on?",
	"Your ideal get-away is:",
	"What do you find an important characteristic in a partner?"
];


var alll1 = ["From friends",
"Party animal",
"Dinner at a high-end restaurant",
"Latest gadgets",
"All inclusive package",
"He/She gets along with my friends"];

var alll2 = ["From Internet",
"Geek",
"Couples massage",
"High-end brands",
"Visiting family and friends",
"That he/she lives healthy"];

var alll3 = ["From doctor",
"An exercise enthusiast",
"Double date night with our friends",
"Anything that can simplify my life",
"Active holiday",
"That he/she is wealthy"];

var alll4 = ["At the local tobacco shop",
"Fashionable",
"Not having to do chores for one evening",
"Beauty products",
"Luxury escape",
"That he/she is good looking"];

var namesl1 = ["Social",
"Social", "Luxury", "Tech", "Convenience", "Social"];

var namesl2 = ["Tech",
"Tech", "Vanity", "Luxury", "Social", "Lifestyle"];

var namesl3 = ["Lifestyle",
"Lifestyle", "Social", "Convenience", "Lifestyle", "Luxury"];

var namesl4 = ["Convenience",
"Luxury", "Convenience", "Vanity", "Luxury", "Vanity"];

var lQ = 6;
var tQ = lQ + 1;

var score = {
	"Vanity": 0,
	"Lifestyle": 0,
	"Social": 0,
	"Convenience": 0,
	"Tech": 0,
	"Luxury": 0,
};

function nextQuestion(pic){

	var fname = document.getElementById(pic).src;

	var last1 = fname.substring(fname.lastIndexOf("/") + 1, fname.length);
	var last2 = last1.substring(2, last1.length - 4);

	// increment score
	score[last2] = score[last2] + 1;

	var qC = qn + 2;

	document.getElementById('question').innerHTML = allQ[qn];
	document.getElementById('l1caption').innerHTML = alll1[qn];
	document.getElementById('l2caption').innerHTML = alll2[qn];
	document.getElementById('l3caption').innerHTML = alll3[qn];
	document.getElementById('l4caption').innerHTML = alll4[qn];

	document.getElementById('l1').src = "./img/q" + qC + namesl1[qn] + ".jpg";
	document.getElementById('l2').src = "./img/q" + qC + namesl2[qn] + ".jpg";
	document.getElementById('l3').src = "./img/q" + qC + namesl3[qn] + ".jpg";
	document.getElementById('l4').src = "./img/q" + qC + namesl4[qn] + ".jpg";

	qn = qn + 1;
	if (qn > lQ){congrats3()}
}


// Render output page
function congrats2(){

	// normalize scores
	score["Tech"] = score["Tech"] * 1.5;
	score["Lifestyle"] = score["Lifestyle"] * (6/5);
	score["Convenience"] = score["Convenience"] * 1.5;
	score["Vanity"] = score["Vanity"] * 2;

	function sum( obj ) {
		var sum = 0;
		for( var el in obj ) {
			if( obj.hasOwnProperty( el ) ) {
				sum += parseFloat( obj[el] );
			}
		}
		return sum;
	}

	tQ = sum(score);


	document.getElementById('question').innerHTML = "";
	document.getElementById('secondRow').innerHTML = "";

	var chart = new CanvasJS.Chart("firstRow", {
		animationEnabled: true,

		title:{
			text:"Your personality composition is likely:"
		},
		axisX:{
			interval: 1
		},
		axisY2:{
			interlacedColor: "rgba(1,77,101,.2)",
			gridColor: "rgba(1,77,101,.1)",
			title: "Percentage"
		},
		data: [{
			type: "bar",
			name: "companies",
			axisYType: "secondary",
			color: "#014D65",
			dataPoints: [
				{ y: Math.round(100*score["Social"]/tQ), label: "Social" },
				{ y: Math.round(100*score["Tech"]/tQ), label: "Tech" },
				{ y: Math.round(100*score["Lifestyle"]/tQ), label: "Lifestyle" },
				{ y: Math.round(100*score["Convenience"]/tQ), label: "Convenience" },
				{ y: Math.round(100*score["Vanity"]/tQ), label: "Vanity" },
				{ y: Math.round(100*score["Luxury"]/tQ), label: "Luxury" },
			]
		}]
	});
	chart.render();

}
// End of the results output


// Render output page
function congrats3(){

	// normalize scores
	score["Tech"] = score["Tech"] * 1.5;
	score["Lifestyle"] = score["Lifestyle"] * (6/5);
	score["Convenience"] = score["Convenience"] * 1.5;
	score["Vanity"] = score["Vanity"] * 2;

	function sortProperties(obj)
	{
		var sortable=[];
		for(var key in obj)
		{
			sortable.push([key, obj[key]]);
		}

		sortable.sort(function(a, b)
		{
			return a[1]-b[1];
		});
		return sortable; // array in format [ [ key1, val1 ], [ key2, val2 ], ... ]
	}

	// sort the scores
	var sscores = sortProperties(score);

	var last_element = sscores[sscores.length - 1];
	var second_last_element = sscores[sscores.length - 2];

	// Resolve the ties

	var dominant_pillar = last_element["0"];
	var dominant_score = last_element["1"];

	var second_score = second_last_element["1"];

	if (dominant_score == second_score){

		var second_pillar = second_last_element["0"];

		rankPillars = {
			"Vanity": 2,
			"Lifestyle": 5,
			"Social": 3,
			"Convenience": 4,
			"Tech": 1,
			"Luxury": 0
		}

		score[dominant_pillar] = score[dominant_pillar] + rankPillars[dominant_pillar];
		score[second_pillar] = score[second_pillar] + rankPillars[second_pillar];
		sscores = sortProperties(score);
		last_element = sscores[sscores.length - 1];
		var dominant_pillar = last_element["0"];

	}

	// console.log(sortProperties(score));
	// console.log(last_element["0"]);

	function sum( obj ) {
		var sum = 0;
		for( var el in obj ) {
			if( obj.hasOwnProperty( el ) ) {
				sum += parseFloat( obj[el] );
			}
		}
		return sum;
	}

	tQ = sum(score);


	document.getElementById('question').innerHTML = dominant_pillar;
	document.getElementById('firstRow').innerHTML = "<img src=./img/" + dominant_pillar + ".jpg>";
	document.getElementById('secondRow').innerHTML = "text";


}
// End of the results output

</script>

</body>
